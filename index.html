<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Queue Master</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap">
    <style>
        :root {
            /* System fonts with Inter as webfont fallback */
            --font-primary: -apple-system, BlinkMacSystemFont, 'Inter', sans-serif;
            
            /* Spacing scale */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;

            /* Colors */
            --color-primary: #007AFF;
            --color-background: #FFFFFF;
            --color-surface: #F5F7FA;
            --color-text: #1C1C1E;
            --color-text-secondary: #6C6C70;
            --color-border: #E5E5EA;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            
            /* New variables */
            --color-success: #12b886;
            --color-success-light: #ebfbee;
            --color-warning: #fab005;
            --color-error: #fa5252;
            --color-info: #228be6;
            
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            
            /* Animation curves */
            --bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
            box-sizing: border-box;

            /* Add these scrollbar styles */
            --scrollbar-width: 8px;
            --scrollbar-track: var(--color-surface);
            --scrollbar-thumb: #CBD5E0;
        }

        *, *:before, *:after {
            box-sizing: inherit;
        }

        body {
            font-family: var(--font-primary);
            background: var(--color-background);
            color: var(--color-text);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
        }
        .container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            height: calc(100vh - 150px); /* Account for header and margins */
        }
        .player-pool {
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden; /* Prevent container overflow */
        }
        .player-pool h2 {
            padding: var(--spacing-md);
            margin: 0;
        }
        .player-pool-controls {
            padding: var(--spacing-md);
            background: #fff;
            border-bottom: 1px solid var(--color-border);
            flex-shrink: 0; /* Prevent controls from shrinking */
        }
        #availablePlayers {
            padding: var(--spacing-md);
            overflow-y: auto; /* Enable scrolling */
            flex-grow: 1; /* Take remaining space */
        }
        .court {
            background: var(--color-surface);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            border-radius: 8px;
            min-height: 100px;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .court-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .finish-game-btn {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 0.9em;
        }
        .finish-game-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .game-result-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
        }
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
            backdrop-filter: blur(2px);
        }
        .player-card {
            background: white;
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: var(--spacing-md);
            margin: var(--spacing-sm) 0;
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
            position: relative;
            cursor: grab;
        }
        .player-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        .player-card.in-game {
            cursor: default;
            opacity: 0.9;
        }
        .player-card.in-game:hover {
            transform: none;
            box-shadow: var(--shadow-sm);
        }
        .player-card.in-game .player-card-actions,
        .player-card.in-game .edit-hint,
        .player-card.in-game .delete-btn {
            display: none;
        }
        .player-stats {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        .court.dragover {
            transform: scale(1.01);
            border: 2px dashed var(--color-primary);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
            transition: all 0.2s ease;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            cursor: pointer;
        }
        .game-history {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .history-entry {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }
        .sort-filter-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .timer {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        .timer.warning {
            color: #f03e3e;
            font-weight: bold;
        }
        .search-box {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        .court-controls {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .start-game-btn {
            background: #228be6;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 0.9em;
        }
        .start-game-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .footer {
            margin-top: 40px;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #dee2e6;
            color: #6c757d;
        }
        .footer a {
            color: #228be6;
            text-decoration: none;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        
        /* Add responsive styles */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .player-pool {
                max-height: 300px;
                overflow-y: auto;
            }

            .court-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .court-controls {
                width: 100%;
            }

            .start-game-btn,
            .finish-game-btn {
                width: 100%;
                padding: 12px;
                margin: 5px 0;
            }

            .player-card {
                padding: var(--spacing-lg);
                margin: var(--spacing-md) 0;
            }

            .player-card:active {
                transform: scale(0.98);
                background: var(--color-surface);
            }

            .sort-filter-options {
                flex-direction: column;
                width: 100%;
            }

            .sort-filter-options select {
                width: 100%;
                padding: 8px;
            }

            .game-result-dialog {
                width: 90%;
                max-width: none;
                padding: 15px;
            }

            .controls {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .controls button {
                width: 100%;
                padding: 12px;
            }

            h1 {
                font-size: 1.5em;
                text-align: center;
            }

            h2 {
                font-size: 1.2em;
            }

            .timer {
                font-size: 1em;
                text-align: center;
                width: 100%;
                background: #f8f9fa;
                padding: 5px;
                border-radius: 4px;
            }
        }

        /* Add touch-friendly styles */
        @media (hover: none) {
            .player-card {
                cursor: grab;
                touch-action: none;
                user-select: none;
                -webkit-user-select: none;
            }

            .player-card:active {
                background: #e9ecef;
                transform: scale(0.98);
            }

            .court.dragover {
                border: 3px dashed #339af0;
            }
        }

        /* Improve dialog on mobile */
        .game-result-dialog {
            max-height: 90vh;
            overflow-y: auto;
        }

        .game-result-dialog input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }

        .game-result-dialog label {
            display: inline-flex;
            align-items: center;
            padding: 10px 0;
        }

        .edit-player-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            width: 90%;
            max-width: 400px;
        }
        .player-card-actions {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }
        .edit-btn {
            background: #228be6;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8em;
            cursor: pointer;
        }
        .delete-btn {
            background: #fa5252;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8em;
            cursor: pointer;
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            padding: 12px 24px;
            border-radius: 8px;
            margin: 8px;
            color: white;
            animation: slideIn 0.3s var(--bounce);
            box-shadow: var(--shadow-md);
        }

        .toast-success { background: var(--color-success); }
        .toast-error { background: var(--color-error); }
        .toast-info { background: var(--color-info); }

        /* Empty states */
        .empty-state {
            text-align: center;
            padding: var(--spacing-lg);
            background: var(--color-surface);
            border-radius: 8px;
            margin: var(--spacing-md);
        }

        .empty-state img {
            width: 120px;
            height: 120px;
            margin-bottom: var(--spacing-md);
            opacity: 0.8;
        }

        .empty-state h3 {
            color: var(--color-text);
            margin-bottom: var(--spacing-sm);
        }

        .empty-state p {
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-lg);
        }

        /* Status pills */
        .status-pill {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .status-pill.active {
            background: var(--color-success-light);
            color: var(--color-success);
        }

        .status-pill.waiting {
            background: var(--color-surface);
            color: var(--color-text-secondary);
        }

        /* Enhanced court styling */
        .court {
            transition: all 0.2s var(--bounce);
        }

        .court.can-drop {
            background: var(--color-success-light);
            border: 2px dashed var(--color-success);
            transform: scale(1.02);
        }

        /* Player card enhancements */
        .player-card {
            transform-origin: center;
            transition: all 0.2s var(--bounce);
        }

        .player-card[dragging="true"] {
            transform: scale(1.05) rotate(2deg);
            box-shadow: var(--shadow-lg);
            opacity: 0.9;
        }

        /* Modern dialog styling */
        .modal, .player-search-modal {
            box-sizing: border-box;
            background: var(--color-background);
            border-radius: 16px;
            padding: var(--spacing-xl);
            width: min(500px, 95%);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            overflow-y: auto;
            max-height: min(600px, 80vh);
            transition: transform 0.3s var(--bounce), opacity 0.2s ease;
            opacity: 0;
            transform: translate(-50%, -48%);
        }

        .modal[style*="display: block"], 
        .player-search-modal[style*="display: block"] {
            opacity: 1;
            transform: translate(-50%, -50%);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-sm);
            color: var(--color-text);
            font-weight: 500;
            font-size: 1em;
        }

        .level-selector {
            box-sizing: border-box;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-xs);
            margin-top: var(--spacing-sm);
            width: 100%;
        }

        .level-option {
            padding: var(--spacing-sm);
            background: white;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .level-option h4 {
            margin: 0 0 var(--spacing-xs) 0;
            font-size: 1em;
        }

        .level-option p {
            margin: 0;
            font-size: 0.9em;
            color: var(--color-text-secondary);
        }

        .level-option:hover {
            border-color: var(--color-primary);
            background: white;
        }

        .level-option.selected {
            border-color: var(--color-primary);
            background: var(--color-primary);
            color: white;
        }

        .level-option.selected p {
            color: rgba(255, 255, 255, 0.9);
        }

        /* Game results styling */
        .game-results {
            text-align: center;
            padding: var(--spacing-lg);
        }

        .results-summary {
            margin-top: var(--spacing-md);
        }

        .duration {
            font-size: 1.2em;
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-md);
        }

        .player-results {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Keyboard shortcut hints */
        .shortcut-hint {
            position: absolute;
            right: var(--spacing-sm);
            bottom: var(--spacing-sm);
            font-size: 0.8em;
            color: var(--color-text-secondary);
            background: var(--color-surface);
            padding: 2px 6px;
            border-radius: 4px;
            opacity: 0.8;
        }

        /* Touch gesture hints */
        @media (hover: none) {
            .gesture-hint {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 0.9em;
                pointer-events: none;
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .gesture-hint.visible {
                opacity: 1;
            }
        }

        .player-card {
            position: relative;
            padding: var(--spacing-md);
        }

        .editable-text {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
        }

        .editable-text:hover {
            background: var(--color-surface);
        }

        .edit-hint {
            opacity: 0;
            font-size: 0.8em;
            margin-left: 4px;
            color: var(--color-text-secondary);
            transition: opacity 0.2s ease;
        }

        .player-name:hover .edit-hint,
        .player-level:hover .edit-hint {
            opacity: 1;
        }

        .inline-edit-name,
        .inline-edit-level {
            width: 100%;
            padding: 8px;
            margin-bottom: 8px;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            font-size: 1em;
        }

        .inline-edit-actions {
            display: flex;
            gap: 8px;
        }

        .save-btn,
        .cancel-btn {
            padding: 4px 8px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
        }

        .save-btn {
            background: var(--color-success);
            color: white;
        }

        .cancel-btn {
            background: var(--color-surface);
            color: var(--color-text);
        }

        .delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: transparent;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .player-card:hover .delete-btn {
            opacity: 1;
        }

        .delete-icon {
            font-size: 1.2em;
        }

        /* Add these new styles after existing styles */
        .court-add-player {
            width: 95%;
            margin: var(--spacing-md) auto;
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--color-info);
            color: white;
            border: none;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s var(--bounce);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            font-weight: 500;
        }

        .court-add-player:hover {
            background: var(--color-primary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .court-add-player:active {
            transform: translateY(0);
        }

        /* Update the add player button icon and text */
        .court-add-player::before {
            content: "+";
            margin-right: 4px;
        }

        @media (max-width: 768px) {
            .court-add-player {
                padding: var(--spacing-md);
            }
        }

        .player-search-results {
            margin-top: var(--spacing-md);
        }

        .search-result-item {
            padding: var(--spacing-sm);
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .search-result-item:hover {
            background: var(--color-surface);
        }

        /* Improve mobile court styling */
        @media (max-width: 768px) {
            .court {
                padding: var(--spacing-lg);
                margin-bottom: var(--spacing-lg);
            }

            .player-search-modal {
                padding: var(--spacing-md);
            }
        }

        /* Update the player cards container to allow for the add button */
        .court .player-cards {
            flex: 1;
            min-height: 50px; /* Ensure minimum height even when empty */
        }

        /* Add/update these styles */
        .form-group input[type="text"] {
            box-sizing: border-box;
            width: 100%;
            padding: var(--spacing-md);
            font-size: 1.1em;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            transition: all 0.2s ease;
            background: white;
        }

        .form-group input[type="text"]:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .form-group input[type="text"]::placeholder {
            color: var(--color-text-secondary);
            opacity: 0.7;
        }

        /* Update the form-group spacing */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        /* Update the modal form */
        .modal form {
            margin-top: var(--spacing-md);
        }

        /* Update the form actions */
        .form-actions {
            display: flex;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-xl);
        }

        .form-actions button {
            flex: 1;
            padding: var(--spacing-md);
            font-size: 1em;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .form-actions button[type="submit"] {
            background: var(--color-primary);
            color: white;
        }

        .form-actions button[type="submit"]:hover {
            background: #0056b3;
        }

        .form-actions button[type="button"] {
            background: var(--color-surface);
            color: var(--color-text);
        }

        .form-actions button[type="button"]:hover {
            background: #e9ecef;
        }

        /* Add these styles */
        .bulk-textarea {
            width: 100%;
            padding: var(--spacing-md);
            font-size: 1em;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            resize: vertical;
            font-family: var(--font-primary);
            background: white;
        }

        .bulk-textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .bulk-instructions {
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-md);
            font-size: 0.9em;
        }

        .bulk-level-select {
            width: 100%;
            padding: var(--spacing-sm);
            border: 2px solid var(--color-border);
            border-radius: 8px;
            font-size: 1em;
            background: white;
        }

        .bulk-level-select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        /* Add these styles */
        .modal-close {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: transparent;
            border: none;
            color: var(--color-text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: var(--spacing-xs);
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            color: var(--color-text);
            transform: scale(1.1);
        }

        /* Make courts container scrollable too */
        .courts-container {
            height: 100%;
            overflow-y: auto;
        }

        .courts-container h2 {
            position: sticky;
            top: 0;
            background: var(--color-background);
            padding: var(--spacing-md) 0;
            margin: 0;
            z-index: 1;
        }

        /* Scrollbar styling */
        .player-pool #availablePlayers,
        .courts-container {
            scrollbar-width: thin;
            scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
        }

        /* For Webkit browsers (Chrome, Safari, etc) */
        .player-pool #availablePlayers::-webkit-scrollbar,
        .courts-container::-webkit-scrollbar {
            width: var(--scrollbar-width);
        }

        .player-pool #availablePlayers::-webkit-scrollbar-track,
        .courts-container::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
            border-radius: var(--scrollbar-width);
        }

        .player-pool #availablePlayers::-webkit-scrollbar-thumb,
        .courts-container::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
            border-radius: var(--scrollbar-width);
        }

        .player-pool #availablePlayers::-webkit-scrollbar-thumb:hover,
        .courts-container::-webkit-scrollbar-thumb:hover {
            background: #A0AEC0;
        }

        /* Update container padding to account for scrollbar */
        .player-pool #availablePlayers,
        .courts-container {
            padding-right: calc(var(--spacing-md) + var(--scrollbar-width));
        }

        /* Add/update these styles */
        .bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: var(--spacing-md);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .bottom-nav-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-sm);
        }

        .bottom-nav button {
            width: 100%;
            margin: 0;
            padding: var(--spacing-md);
            border: none;
            background: var(--color-surface);
            color: var(--color-text);
            border-radius: 8px;
            font-weight: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 0.9em;
        }

        .bottom-nav button::before {
            font-size: 1.2em;
            margin-bottom: 2px;
        }

        .bottom-nav button:nth-child(1)::before { content: "+" }
        .bottom-nav button:nth-child(2)::before { content: "⫘" }
        .bottom-nav button:nth-child(3)::before { content: "◷" }

        .bottom-nav button.active {
            background: var(--color-primary);
            color: white;
        }

        /* Update mobile styles */
        @media (max-width: 768px) {
            body {
                padding-bottom: 80px; /* Account for bottom nav */
            }

            .container {
                grid-template-columns: 1fr;
                height: calc(100vh - 180px);
            }

            /* Hide desktop controls */
            .controls {
                display: none;
            }

            /* Always show courts container */
            .courts-container {
                display: block !important;
                height: 100%;
                overflow-y: auto;
                padding-bottom: var(--spacing-xl);
            }

            /* Show bottom nav */
            .bottom-nav {
                display: block;
            }

            /* Hide player pool by default */
            .player-pool {
                display: none;
            }
        }

        /* Add this to your existing media queries in the style section */
        @media (max-width: 768px) {
            .courts-container {
                display: block !important; /* Ensure courts are always visible on mobile */
            }
        }
    </style>
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>

    <h1>Queue Master</h1>

    <div class="controls">
        <button onclick="addNewPlayer()">
            <span>Add New Player</span>
            <span class="shortcut-hint">A</span>
        </button>
        <button onclick="showBulkAddDialog()">
            <span>Bulk Add Players</span>
            <span class="shortcut-hint">B</span>
        </button>
        <button onclick="showGameHistory()">
            <span>Game History</span>
            <span class="shortcut-hint">H</span>
        </button>
    </div>

    <div class="container">
        <div class="player-pool" ondrop="drop(event)" ondragover="allowDrop(event)">
            <h2>Available Players</h2>
            <div id="playerPoolEmpty" class="empty-state" style="display: none;">
                <img src="https://api.iconify.design/ph:users-three-light.svg" alt="No players">
                <h3>No Players Yet</h3>
                <p>Add players to start managing games</p>
                <button onclick="addNewPlayer()">Add First Player</button>
            </div>
            <div class="player-pool-controls">
                <input type="text" 
                       class="search-box" 
                       id="playerSearch" 
                       placeholder="Search players..."
                       oninput="updateDisplay()">
                <div class="sort-filter-options">
                    <select id="sortBy" onchange="updateDisplay()">
                        <option value="gamesAsc">Games (Least to Most)</option>
                        <option value="gamesDesc">Games (Most to Least)</option>
                        <option value="levelAsc">Level (Low to High)</option>
                        <option value="levelDesc">Level (High to Low)</option>
                        <option value="name">Name</option>
                    </select>
                </div>
            </div>
            <div id="availablePlayers"></div>
        </div>

        <div class="courts-container">
            <h2>Courts</h2>
            <div id="courts"></div>
        </div>
    </div>

    <div id="gameHistory" class="game-history" style="display: none;">
        <h2>Game History</h2>
        <div id="historyEntries"></div>
    </div>

    <div id="dialogOverlay" class="dialog-overlay"></div>
    <div id="gameResultDialog" class="game-result-dialog">
        <h3>Game Results</h3>
        <div id="gameResultContent"></div>
        <button onclick="submitGameResults()">Submit Results</button>
    </div>

    <div id="editPlayerDialog" class="edit-player-dialog">
        <h3>Edit Player</h3>
        <div>
            <input type="text" id="editPlayerName" placeholder="Player Name" style="width: 100%; margin-bottom: 10px;">
            <select id="editPlayerLevel" style="width: 100%; margin-bottom: 10px;">
                <option value="1">Level 1 - Beginner (Learning the basics)</option>
                <option value="2">Level 2 - Intermediate (Consistent rallies)</option>
                <option value="3">Level 3 - Advanced (Good game control)</option>
                <option value="4">Level 4 - Expert (Strong all-around player)</option>
                <option value="5">Level 5 - Pro (Tournament level)</option>
            </select>
            <button onclick="savePlayerEdit()" style="margin-right: 10px;">Save Changes</button>
            <button onclick="closeEditDialog()">Cancel</button>
        </div>
    </div>

    <div id="addPlayerDialog" class="modal" style="display: none;">
        <button class="modal-close" onclick="closeAddPlayerDialog()">×</button>
        <h3>Add New Player</h3>
        <form onsubmit="handleAddPlayer(event)">
            <div class="form-group">
                <label for="newPlayerName">Player Name</label>
                <input 
                    type="text" 
                    id="newPlayerName" 
                    placeholder="Enter player name"
                    required
                    autocomplete="off"
                    autofocus>
            </div>
            <div class="form-group">
                <label>Skill Level</label>
                <div class="level-selector">
                    <div class="level-option" data-value="1" onclick="selectLevel(1)">
                        <h4>Beginner</h4>
                        <p>Learning the basics, new to the game</p>
                    </div>
                    <div class="level-option" data-value="2" onclick="selectLevel(2)">
                        <h4>Intermediate</h4>
                        <p>Can maintain consistent rallies</p>
                    </div>
                    <div class="level-option" data-value="3" onclick="selectLevel(3)">
                        <h4>Advanced</h4>
                        <p>Good game control and strategy</p>
                    </div>
                    <div class="level-option" data-value="4" onclick="selectLevel(4)">
                        <h4>Expert</h4>
                        <p>Strong all-around player</p>
                    </div>
                    <div class="level-option" data-value="5" onclick="selectLevel(5)">
                        <h4>Pro</h4>
                        <p>Tournament level player</p>
                    </div>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit">Add Player</button>
                <button type="button" onclick="closeAddPlayerDialog()">Cancel</button>
            </div>
        </form>
    </div>

    <div id="playerSearchModal" class="player-search-modal">
        <button class="modal-close" onclick="closePlayerSearch()">×</button>
        <h3>Add Player to Court</h3>
        <input type="text" 
               id="courtPlayerSearch" 
               class="search-box" 
               placeholder="Search players..."
               oninput="searchCourtPlayers()">
        <div id="playerSearchResults" class="player-search-results"></div>
        <button onclick="closePlayerSearch()" style="margin-top: 16px;">Cancel</button>
    </div>

    <div id="bulkAddDialog" class="modal" style="display: none;">
        <button class="modal-close" onclick="closeBulkAddDialog()">×</button>
        <h3>Bulk Add Players</h3>
        <p class="bulk-instructions">Paste a list of names, one per line. Each player will be added as Level 1.</p>
        <form onsubmit="handleBulkAddPlayers(event)">
            <div class="form-group">
                <label for="bulkPlayerNames">Player Names</label>
                <textarea 
                    id="bulkPlayerNames" 
                    placeholder="John Smith
Jane Doe
Mike Johnson"
                    required
                    rows="10"
                    class="bulk-textarea"></textarea>
            </div>
            <div class="form-group">
                <label for="bulkPlayerLevel">Default Level</label>
                <select id="bulkPlayerLevel" class="bulk-level-select">
                    <option value="1">Level 1 - Beginner</option>
                    <option value="2">Level 2 - Intermediate</option>
                    <option value="3">Level 3 - Advanced</option>
                    <option value="4">Level 4 - Expert</option>
                    <option value="5">Level 5 - Pro</option>
                </select>
            </div>
            <div class="form-actions">
                <button type="submit">Add Players</button>
                <button type="button" onclick="closeBulkAddDialog()">Cancel</button>
            </div>
        </form>
    </div>

    <footer class="footer">
        by <a href="https://alexiscollado.com" target="_blank">Alexis Collado</a>
    </footer>

    <div class="bottom-nav">
        <div class="bottom-nav-buttons">
            <button onclick="addNewPlayer()">
                <span>Add Player</span>
            </button>
            <button onclick="showBulkAddDialog()">
                <span>Bulk Add</span>
            </button>
            <button onclick="showGameHistory()">
                <span>History</span>
            </button>
        </div>
    </div>

    <script>
        let players = [];
        let courts = [];
        let gameHistory = [];
        const COURTS_COUNT = 3;
        const GAME_DURATION_WARNING = 20 * 60 * 1000; // 20 minutes in milliseconds

        // Initialize courts with timer properties
        function initializeCourts() {
            courts = Array(COURTS_COUNT).fill().map(() => ({
                players: [],
                startTime: null
            }));
            updateDisplay();
        }

        function getElapsedTime(startTime) {
            if (!startTime) return 'Not started';
            const elapsed = Date.now() - startTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateTimers() {
            courts.forEach((court, i) => {
                if (court.players && court.players.length >= 2) {
                    const timerElement = document.getElementById(`timer-${i}`);
                    if (timerElement) {
                        const elapsedTime = getElapsedTime(court.startTime);
                        timerElement.textContent = elapsedTime;
                        
                        // Add warning class if game is running long
                        if (court.startTime && (Date.now() - court.startTime) > GAME_DURATION_WARNING) {
                            timerElement.classList.add('warning');
                        }
                    }
                }
            });
        }

        // Start timer updates
        setInterval(updateTimers, 1000);

        function sortAndFilterPlayers(players) {
            const searchTerm = document.getElementById('playerSearch').value.toLowerCase();
            const sortBy = document.getElementById('sortBy').value;

            let filtered = players.filter(p => 
                p.name.toLowerCase().includes(searchTerm)
            );

            filtered.sort((a, b) => {
                switch (sortBy) {
                    case 'gamesAsc':
                        return a.gamesPlayed - b.gamesPlayed;
                    case 'gamesDesc':
                        return b.gamesPlayed - a.gamesPlayed;
                    case 'levelAsc':
                        return a.level - b.level;
                    case 'levelDesc':
                        return b.level - a.level;
                    case 'name':
                        return a.name.localeCompare(b.name);
                    default:
                        return 0;
                }
            });

            return filtered;
        }

        function updateDisplay() {
            // Update available players with sorting and filtering
            const availablePlayers = players.filter(p => 
                !courts.some(court => court.players.some(cp => cp.id === p.id))
            );
            
            const sortedAndFiltered = sortAndFilterPlayers(availablePlayers);
            
            document.getElementById('availablePlayers').innerHTML = 
                sortedAndFiltered.map(createPlayerCard).join('');

            // Update courts
            document.getElementById('courts').innerHTML = courts.map((court, i) => `
                <div class="court" 
                     id="court-${i}" 
                     ondrop="drop(event)" 
                     ondragover="allowDrop(event)">
                    <div class="court-header">
                        <h3>Court ${i + 1} (${court.players.length} players)</h3>
                        <div class="court-controls">
                            <div class="timer" id="timer-${i}">
                                ${court.startTime ? getElapsedTime(court.startTime) : 'Not started'}
                            </div>
                            ${!court.startTime ? `
                                <button 
                                    class="start-game-btn" 
                                    onclick="startGame(${i})"
                                    ${court.players.length < 2 ? 'disabled' : ''}>
                                    Start Game
                                </button>
                            ` : `
                                <button 
                                    class="finish-game-btn" 
                                    onclick="finishCourtGame(${i})">
                                    Finish Game
                                </button>
                            `}
                        </div>
                    </div>
                    <div class="player-cards">
                        ${court.players.map(createPlayerCard).join('')}
                    </div>
                    ${court.players.length < 4 && !court.startTime ? `
                        <div class="court-add-player" onclick="showPlayerSearch(${i})">
                            Add Player
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function allowDrop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.add('dragover');
        }

        function drag(ev) {
            const playerId = ev.target.id.replace('player-', '');
            const isInGame = courts.some(court => 
                court.startTime && court.players.some(p => p.id === playerId)
            );
            
            if (isInGame) {
                ev.preventDefault();
                return;
            }
            
            ev.dataTransfer.setData("playerId", ev.target.id);
        }

        function drop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('dragover');
            
            const playerId = ev.dataTransfer.getData("playerId").replace('player-', '');
            const player = players.find(p => p.id === playerId);
            const targetCourt = ev.currentTarget.id.replace('court-', '');

            // Remove player from current location
            courts.forEach(court => {
                const playerIndex = court.players.findIndex(p => p.id === playerId);
                if (playerIndex !== -1) {
                    court.players.splice(playerIndex, 1);
                }
            });

            // Add to new court if dropped on court
            if (targetCourt !== '') {
                const courtIndex = parseInt(targetCourt);
                if (!isNaN(courtIndex) && courts[courtIndex].players.length < 4) {
                    courts[courtIndex].players.push(player);
                }
            }

            updateDisplay();
        }

        function startGame(courtIndex) {
            const court = courts[courtIndex];
            if (court.players.length < 2) {
                showToast('Need at least 2 players to start a game!', 'error');
                return;
            }
            
            court.startTime = Date.now();
            showToast('Game started!');
            updateDisplay();
        }

        function finishCourtGame(courtIndex) {
            const court = courts[courtIndex];
            if (!court.startTime) {
                alert('Game has not been started yet!');
                return;
            }
            if (court.players.length < 2) {
                alert('Not enough players to finish a game!');
                return;
            }

            showGameResultDialog(courtIndex);
        }

        function showGameResultDialog(courtIndex) {
            const court = courts[courtIndex];
            const dialog = document.getElementById('gameResultDialog');
            const overlay = document.getElementById('dialogOverlay');
            const content = document.getElementById('gameResultContent');

            content.innerHTML = `
                <p>Select winners for Court ${courtIndex + 1}:</p>
                ${court.players.map(player => `
                    <div>
                        <input type="checkbox" 
                               id="winner-${player.id}" 
                               name="winners" 
                               value="${player.id}">
                        <label for="winner-${player.id}">
                            ${player.name} (Level ${player.level})
                        </label>
                    </div>
                `).join('')}
            `;

            dialog.dataset.courtIndex = courtIndex;
            dialog.style.display = 'block';
            overlay.style.display = 'block';
        }

        function submitGameResults() {
            const dialog = document.getElementById('gameResultDialog');
            const courtIndex = parseInt(dialog.dataset.courtIndex);
            const court = courts[courtIndex];
            
            const winners = Array.from(document.querySelectorAll('input[name="winners"]:checked'))
                .map(input => input.value);

            // Record game in history
            const gameEntry = {
                date: new Date(),
                courtNumber: courtIndex + 1,
                players: court.players.map(p => ({
                    name: p.name,
                    level: p.level,
                    winner: winners.includes(p.id)
                }))
            };
            gameHistory.push(gameEntry);

            // Update player stats
            court.players.forEach(player => {
                const p = players.find(p => p.id === player.id);
                if (p) {
                    p.gamesPlayed++;
                    if (winners.includes(player.id)) {
                        p.wins++;
                    } else {
                        p.losses++;
                    }
                }
            });

            // Clear just this court
            courts[courtIndex] = {
                players: [],
                startTime: null
            };
            
            // Close dialog
            dialog.style.display = 'none';
            document.getElementById('dialogOverlay').style.display = 'none';
            
            updateDisplay();
            showGameHistory();
            showToast('Game results recorded successfully!');
        }

        function showGameHistory() {
            document.querySelector('.player-pool').classList.remove('visible');
            document.getElementById('gameHistory').style.display = 'block';
            document.querySelector('.courts-container').style.display = 'none';
            
            // Update active state
            document.querySelectorAll('.bottom-nav button').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.bottom-nav button:nth-child(3)').classList.add('active');
            
            document.getElementById('historyEntries').innerHTML = 
                gameHistory.map((game, index) => `
                    <div class="history-entry">
                        <strong>Game ${index + 1}</strong> - 
                        Court ${game.courtNumber} - 
                        ${new Date(game.date).toLocaleString()}
                        <br>
                        Players: ${game.players.map(p => 
                            `${p.name} (Level ${p.level})`
                        ).join(', ')}
                    </div>
                `).join('');
        }

        function createPlayerCard(player) {
            // Find if player is in an active game
            const isInGame = courts.some(court => 
                court.startTime && court.players.some(p => p.id === player.id)
            );

            return `
                <div class="player-card ${isInGame ? 'in-game' : ''}" 
                     draggable="${!isInGame}"
                     ondragstart="${!isInGame ? 'drag(event)' : ''}"
                     id="player-${player.id}">
                    <div class="player-info" id="player-info-${player.id}">
                        <div class="player-name" onclick="${!isInGame ? `enableInlineEdit('${player.id}', 'name')` : ''}">
                            <span class="editable-text">${player.name}</span>
                            ${!isInGame ? '<span class="edit-hint">✎</span>' : ''}
                        </div>
                        <div class="player-level" onclick="${!isInGame ? `enableInlineEdit('${player.id}', 'level')` : ''}">
                            <span class="editable-text">Level ${player.level}</span>
                            ${!isInGame ? '<span class="edit-hint">✎</span>' : ''}
                        </div>
                        <div class="player-stats">
                            Games: ${player.gamesPlayed} | W/L: ${player.wins}/${player.losses}
                        </div>
                    </div>
                    <div class="player-edit-form" id="player-edit-${player.id}" style="display: none;">
                        <input type="text" 
                               class="inline-edit-name" 
                               value="${player.name}"
                               onkeydown="handleInlineEditKeydown(event, '${player.id}')"
                               data-original="${player.name}">
                        <select class="inline-edit-level" 
                                onchange="updatePlayerInline('${player.id}')"
                                data-original="${player.level}">
                            <option value="1" ${player.level === 1 ? 'selected' : ''}>Level 1 - Beginner</option>
                            <option value="2" ${player.level === 2 ? 'selected' : ''}>Level 2 - Intermediate</option>
                            <option value="3" ${player.level === 3 ? 'selected' : ''}>Level 3 - Advanced</option>
                            <option value="4" ${player.level === 4 ? 'selected' : ''}>Level 4 - Expert</option>
                            <option value="5" ${player.level === 5 ? 'selected' : ''}>Level 5 - Pro</option>
                        </select>
                        <div class="inline-edit-actions">
                            <button onclick="updatePlayerInline('${player.id}')" class="save-btn">Save</button>
                            <button onclick="cancelInlineEdit('${player.id}')" class="cancel-btn">Cancel</button>
                        </div>
                    </div>
                    ${!isInGame ? `
                        <button class="delete-btn" onclick="event.preventDefault(); deletePlayer('${player.id}')">
                            <span class="delete-icon">×</span>
                        </button>
                    ` : ''}
                </div>
            `;
        }

        let selectedLevel = null;

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.getElementById('toastContainer').appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function selectLevel(level) {
            selectedLevel = level;
            document.querySelectorAll('.level-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`.level-option[data-value="${level}"]`).classList.add('selected');
        }

        function showAddPlayerDialog() {
            document.getElementById('addPlayerDialog').style.display = 'block';
            document.getElementById('dialogOverlay').style.display = 'block';
            document.getElementById('newPlayerName').focus();
            selectedLevel = null;
            document.querySelectorAll('.level-option').forEach(option => {
                option.classList.remove('selected');
            });
        }

        function closeAddPlayerDialog() {
            document.getElementById('addPlayerDialog').style.display = 'none';
            document.getElementById('dialogOverlay').style.display = 'none';
            document.getElementById('newPlayerName').value = '';
            selectedLevel = null;
        }

        function handleAddPlayer(event) {
            event.preventDefault();
            
            const name = document.getElementById('newPlayerName').value.trim();
            
            if (!name) {
                showToast('Please enter a player name', 'error');
                return;
            }
            
            if (!selectedLevel) {
                showToast('Please select a skill level', 'error');
                return;
            }

            // Check for duplicate names
            if (players.some(p => p.name.toLowerCase() === name.toLowerCase())) {
                showToast('A player with this name already exists', 'error');
                return;
            }

            players.push({
                id: Date.now().toString(),
                name: name,
                level: selectedLevel,
                gamesPlayed: 0,
                wins: 0,
                losses: 0
            });

            showToast(`Added ${name} successfully!`);
            closeAddPlayerDialog();
            updateDisplay();
        }

        // Replace existing addNewPlayer function with:
        function addNewPlayer() {
            showAddPlayerDialog();
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Don't trigger shortcuts if in an input field
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

            if (e.key === 'a' || e.key === 'A') {
                e.preventDefault();
                addNewPlayer();
            } else if (e.key === 'h' || e.key === 'H') {
                e.preventDefault();
                showGameHistory();
            } else if (e.key === 'Escape') {
                closeAddPlayerDialog();
                closeEditDialog();
                document.getElementById('gameResultDialog').style.display = 'none';
                document.getElementById('dialogOverlay').style.display = 'none';
            }
        });

        let editingPlayerId = null;

        function editPlayer(playerId) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;

            editingPlayerId = playerId;
            document.getElementById('editPlayerName').value = player.name;
            document.getElementById('editPlayerLevel').value = player.level;
            document.getElementById('editPlayerDialog').style.display = 'block';
            document.getElementById('dialogOverlay').style.display = 'block';
        }

        function closeEditDialog() {
            editingPlayerId = null;
            document.getElementById('editPlayerDialog').style.display = 'none';
            document.getElementById('dialogOverlay').style.display = 'none';
        }

        function savePlayerEdit() {
            if (!editingPlayerId) return;

            const name = document.getElementById('editPlayerName').value;
            const level = parseInt(document.getElementById('editPlayerLevel').value);

            if (!name || isNaN(level)) {
                alert('Please fill in all fields correctly');
                return;
            }

            const player = players.find(p => p.id === editingPlayerId);
            if (player) {
                player.name = name;
                player.level = level;
            }

            closeEditDialog();
            updateDisplay();
        }

        function deletePlayer(playerId) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;

            if (!confirm(`Are you sure you want to remove ${player.name}?`)) return;

            const playerIndex = players.findIndex(p => p.id === playerId);
            if (playerIndex > -1) {
                players.splice(playerIndex, 1);
                showToast(`Removed ${player.name}`);
                updateDisplay();
            }
        }

        // Add local storage support
        function saveState() {
            localStorage.setItem('queueMasterState', JSON.stringify({
                players,
                courts,
                gameHistory
            }));
        }

        function loadState() {
            const saved = localStorage.getItem('queueMasterState');
            if (saved) {
                const state = JSON.parse(saved);
                players = state.players || [];
                courts = state.courts || [];
                gameHistory = state.gameHistory || [];
                updateDisplay();
            }
        }

        // Save state after each change
        const originalUpdateDisplay = updateDisplay;
        updateDisplay = function() {
            originalUpdateDisplay();
            saveState();
        };

        // Initialize the app
        loadState();
        initializeCourts();

        function enableInlineEdit(playerId, field) {
            const infoElement = document.getElementById(`player-info-${playerId}`);
            const editElement = document.getElementById(`player-edit-${playerId}`);
            
            infoElement.style.display = 'none';
            editElement.style.display = 'block';
            
            const inputElement = editElement.querySelector(field === 'name' ? '.inline-edit-name' : '.inline-edit-level');
            inputElement.focus();
        }

        function handleInlineEditKeydown(event, playerId) {
            if (event.key === 'Enter') {
                updatePlayerInline(playerId);
            } else if (event.key === 'Escape') {
                cancelInlineEdit(playerId);
            }
        }

        function updatePlayerInline(playerId) {
            const editElement = document.getElementById(`player-edit-${playerId}`);
            const nameInput = editElement.querySelector('.inline-edit-name');
            const levelSelect = editElement.querySelector('.inline-edit-level');
            
            const newName = nameInput.value.trim();
            const newLevel = parseInt(levelSelect.value);
            
            if (!newName) {
                showToast('Name cannot be empty', 'error');
                return;
            }

            const player = players.find(p => p.id === playerId);
            if (player) {
                player.name = newName;
                player.level = newLevel;
                showToast('Player updated successfully');
            }

            cancelInlineEdit(playerId);
            updateDisplay();
        }

        function cancelInlineEdit(playerId) {
            const infoElement = document.getElementById(`player-info-${playerId}`);
            const editElement = document.getElementById(`player-edit-${playerId}`);
            
            infoElement.style.display = 'block';
            editElement.style.display = 'none';
        }

        let currentCourtIndex = null;

        function showPlayerSearch(courtIndex) {
            currentCourtIndex = courtIndex;
            document.getElementById('playerSearchModal').style.display = 'block';
            document.getElementById('dialogOverlay').style.display = 'block';
            document.getElementById('courtPlayerSearch').value = '';
            document.getElementById('courtPlayerSearch').focus();
            searchCourtPlayers();
        }

        function closePlayerSearch() {
            document.getElementById('playerSearchModal').style.display = 'none';
            document.getElementById('dialogOverlay').style.display = 'none';
            currentCourtIndex = null;
        }

        function searchCourtPlayers() {
            const searchTerm = document.getElementById('courtPlayerSearch').value.toLowerCase();
            const availablePlayers = players.filter(p => 
                !courts.some(court => court.players.some(cp => cp.id === p.id)) &&
                p.name.toLowerCase().includes(searchTerm)
            );

            document.getElementById('playerSearchResults').innerHTML = 
                availablePlayers.map(player => `
                    <div class="search-result-item" onclick="addPlayerToCourt('${player.id}')">
                        <strong>${player.name}</strong> (Level ${player.level})
                        <div class="player-stats">
                            Games: ${player.gamesPlayed} | W/L: ${player.wins}/${player.losses}
                        </div>
                    </div>
                `).join('') || '<p>No available players found</p>';
        }

        function addPlayerToCourt(playerId) {
            if (currentCourtIndex === null) return;
            
            const player = players.find(p => p.id === playerId);
            const court = courts[currentCourtIndex];
            
            if (player && court && court.players.length < 4) {
                court.players.push(player);
                showToast(`Added ${player.name} to Court ${currentCourtIndex + 1}`);
                closePlayerSearch();
                updateDisplay();
            } else {
                showToast('Cannot add player to court', 'error');
            }
        }

        function showBulkAddDialog() {
            document.getElementById('bulkAddDialog').style.display = 'block';
            document.getElementById('dialogOverlay').style.display = 'block';
            document.getElementById('bulkPlayerNames').focus();
        }

        function closeBulkAddDialog() {
            document.getElementById('bulkAddDialog').style.display = 'none';
            document.getElementById('dialogOverlay').style.display = 'none';
            document.getElementById('bulkPlayerNames').value = '';
        }

        function handleBulkAddPlayers(event) {
            event.preventDefault();
            
            const namesText = document.getElementById('bulkPlayerNames').value.trim();
            const defaultLevel = parseInt(document.getElementById('bulkPlayerLevel').value);
            
            if (!namesText) {
                showToast('Please enter player names', 'error');
                return;
            }

            const names = namesText.split('\n')
                .map(name => name.trim())
                .filter(name => name.length > 0);

            // Check for duplicates in the input
            const uniqueNames = new Set(names);
            if (uniqueNames.size !== names.length) {
                showToast('Duplicate names found in input', 'error');
                return;
            }

            // Check for existing names
            const existingNames = new Set(players.map(p => p.name.toLowerCase()));
            const duplicates = names.filter(name => 
                existingNames.has(name.toLowerCase())
            );

            if (duplicates.length > 0) {
                showToast(`Some players already exist: ${duplicates.join(', ')}`, 'error');
                return;
            }

            // Add all players
            names.forEach(name => {
                players.push({
                    id: Date.now() + Math.random().toString(36).substr(2, 9),
                    name: name,
                    level: defaultLevel,
                    gamesPlayed: 0,
                    wins: 0,
                    losses: 0
                });
            });

            showToast(`Added ${names.length} players successfully!`);
            closeBulkAddDialog();
            updateDisplay();
        }
    </script>
</body>
</html>